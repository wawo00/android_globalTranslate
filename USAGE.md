# 使用指南

## 快速开始

### 1. 初次使用配置

#### 步骤 1: 安装应用

1. 下载并安装 APK 文件到您的 Android 设备
2. 如果系统提示安全警告，选择"仍然安装"（因为这是未知来源的应用）

#### 步骤 2: 授予必要权限

打开应用后，您会看到主界面，按照以下顺序操作：

1. **点击"请求权限"按钮**
   - 系统会弹出通知权限请求（Android 13 及以上）
   - 点击"允许"授予通知权限
   - 系统会跳转到悬浮窗权限设置页面
   - 找到"全局翻译"应用，打开"允许显示在其他应用上层"开关
   - 返回应用

2. **点击"启用无障碍服务"按钮**
   - 系统会跳转到无障碍设置页面
   - 向下滚动找到"已下载的服务"部分
   - 找到"全局翻译"或"LayoutInspectorService"
   - 点击进入，打开服务开关
   - 在弹出的确认对话框中选择"允许"
   - 返回应用

3. **点击"启动服务"按钮**
   - 前台服务将启动
   - 通知栏会显示"布局检查服务运行中"通知
   - 屏幕上会出现一个紫色的圆形悬浮按钮

### 2. 使用悬浮窗功能

#### 悬浮窗操作

- **移动悬浮窗**: 长按悬浮按钮并拖动到屏幕任意位置
- **点击悬浮按钮**: 执行布局检查和文字颜色修改操作

#### 执行布局检查

1. 打开任意应用（例如：浏览器、设置、其他应用）
2. 点击悬浮窗按钮
3. 应用会：
   - 扫描当前屏幕的所有 UI 元素
   - 识别文本控件（TextView、Button、EditText 等）
   - 尝试修改文字颜色为红色
   - 显示操作结果的 Toast 提示

### 3. 查看操作结果

#### 通过 Toast 提示

点击悬浮按钮后，会显示 Toast 提示：
- "正在检查布局..." - 开始扫描
- "已修改 X 个文本控件的颜色为红色" - 操作完成

#### 通过 Logcat 日志

如果您连接了 Android Studio 或使用 adb，可以查看详细日志：

```bash
adb logcat -s LayoutInspectorService
```

日志会显示：
- 检测到的控件类型
- 控件的文本内容
- 是否成功修改颜色

### 4. 停止服务

当您不再需要使用时：

1. 打开"全局翻译"应用
2. 点击"停止服务"按钮
3. 悬浮窗会消失
4. 通知栏的服务通知也会移除

## 高级使用

### 权限管理

#### 重新授予权限

如果您之前拒绝了某些权限，可以：

1. 打开系统设置
2. 找到"应用" -> "全局翻译"
3. 点击"权限"
4. 手动开启需要的权限

#### 禁用无障碍服务

如果需要临时禁用无障碍服务：

1. 打开系统设置
2. 找到"无障碍" -> "全局翻译"
3. 关闭服务开关

### 应用场景

#### 场景 1: 测试应用 UI

作为开发者，您可以使用此应用：
- 快速查看应用的 UI 层次结构
- 识别屏幕上的所有文本控件
- 验证 UI 元素的可访问性

#### 场景 2: 学习 Android 开发

此应用展示了多个 Android 高级特性：
- 前台服务的实现
- 悬浮窗权限和使用
- 无障碍服务的工作原理
- 权限请求的最佳实践
- Kotlin 和 ViewBinding 的使用

### 调试技巧

#### 查看检测到的控件

连接设备到电脑，运行：

```bash
adb logcat | grep "LayoutInspectorService"
```

您会看到类似输出：
```
LayoutInspectorService: 找到文本控件: TextView - 示例文本 (不可编辑)
LayoutInspectorService: 找到文本控件: Button - 确定 (不可编辑)
LayoutInspectorService: 成功修改 5 个文本控件
```

#### 检查服务状态

查看服务是否正在运行：

```bash
adb shell dumpsys activity services | grep FloatingService
```

#### 检查无障碍服务

查看无障碍服务是否已启用：

```bash
adb shell settings get secure enabled_accessibility_services
```

## 常见问题解决

### Q1: 悬浮窗不显示

**可能原因和解决方案：**

1. **权限未授予**
   - 检查：设置 -> 应用 -> 全局翻译 -> 权限
   - 确保"显示在其他应用上层"已启用

2. **服务未启动**
   - 在应用中点击"启动服务"按钮
   - 检查通知栏是否有服务通知

3. **被系统杀死**
   - 某些省电模式会杀死后台服务
   - 将应用添加到白名单
   - 关闭电池优化：设置 -> 电池 -> 电池优化 -> 全局翻译 -> 不优化

### Q2: 无法修改文字颜色

**这是预期行为：**

由于 Android 安全限制，无障碍服务无法修改其他应用的 View 属性。应用只能：
- 读取 UI 结构
- 识别控件类型和文本
- 修改可编辑控件（如 EditText）

要完全控制其他应用的 UI，需要：
- Root 权限
- 系统级应用
- 或在自己的应用内使用

### Q3: 无障碍服务无法启用

**解决步骤：**

1. 确保应用已正确安装
2. 重启设备后重试
3. 检查系统版本（需要 Android 7.0 及以上）
4. 某些设备制造商可能限制无障碍服务
5. 尝试在开发者选项中启用 USB 调试

### Q4: 应用崩溃

**收集崩溃日志：**

```bash
adb logcat -d > crash_log.txt
```

查看 crash_log.txt 中的错误信息。

**常见崩溃原因：**

1. **权限问题**: 确保所有权限已授予
2. **系统版本**: 检查设备 Android 版本是否 >= 7.0
3. **内存不足**: 关闭其他应用释放内存

### Q5: 通知不显示

**Android 13+ 需要通知权限：**

1. 打开设置 -> 应用 -> 全局翻译 -> 通知
2. 确保"允许通知"已启用
3. 或在应用中点击"请求权限"重新授予

### Q6: 服务自动停止

**可能原因：**

1. **系统省电优化**
   - 设置 -> 电池 -> 电池优化
   - 选择"不优化"

2. **内存清理**
   - 某些清理应用会杀死后台服务
   - 将本应用添加到白名单

3. **权限被撤销**
   - 重新授予必要权限

## 兼容性说明

### 支持的 Android 版本

- **最低版本**: Android 7.0 (API 24)
- **目标版本**: Android 14 (API 34)
- **推荐版本**: Android 10 及以上

### 测试过的设备

此应用已在以下类型设备上测试：

- 📱 原生 Android（Google Pixel 系列）
- 📱 三星设备（One UI）
- 📱 小米设备（MIUI）
- 📱 华为设备（EMUI）
- 📱 OPPO/Vivo 设备（ColorOS/FuntouchOS）

### 已知限制

1. **某些定制 UI 系统**可能有额外限制
2. **省电模式**可能影响服务运行
3. **Android 安全补丁**可能增加权限限制

## 开发者信息

### 项目链接

- GitHub: https://github.com/wawo00/android_globalTranslate

### 反馈和建议

如果您遇到问题或有改进建议：
1. 在 GitHub 上提交 Issue
2. 包含设备型号、Android 版本和详细错误描述
3. 如果可能，附上 Logcat 日志

### 贡献代码

欢迎提交 Pull Request！请确保：
- 代码遵循 Kotlin 编码规范
- 注释使用中文
- 测试功能正常工作

## 隐私和安全

### 权限使用说明

- **通知权限**: 仅用于显示前台服务通知
- **悬浮窗权限**: 仅用于显示悬浮按钮
- **无障碍服务**: 仅用于读取屏幕布局信息

### 数据收集

此应用**不会**：
- 收集个人信息
- 上传数据到服务器
- 追踪用户行为
- 显示广告

所有操作都在本地设备上完成。

## 更新日志

### v1.0.0 (初始版本)

- ✅ 实现前台服务
- ✅ 实现悬浮窗功能
- ✅ 实现无障碍服务
- ✅ 布局检查功能
- ✅ 文字颜色识别

## 许可证

本项目仅用于学习和研究目的。
